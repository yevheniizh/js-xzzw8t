<label style="color: white;">Play-pause toggler
  <input type="checkbox" disabled id="play-pause-toggler" />
</label>

<label style="color: white;">Audio enhancer toggler
  <input type="checkbox" disabled id="audio-enhancer-toggler" />
</label>

<div style="width: 300px; height: 40px; background-color: rgba(100, 100, 200, 0.5);" id="audio-progress-bar-container"></div>

<!-- To be migrated to the Webflow -->
<style>
  #play-pause-toggler + span, #audio-enhancer-toggler + span {
    user-select: none;
  }
  #audio-progress-bar-container {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  input[type='range'] {
    overflow: hidden;
    width: 100%;
    -webkit-appearance: none;
    background-color: rgb(214 215 216);
    border-radius: 3px;
  }
  input[type='range']::-webkit-slider-runnable-track {
    height: 6px;
    -webkit-appearance: none;
    margin-top: -1px;
    cursor: pointer;
  }
  input[type='range']::-webkit-slider-thumb {
    width: 6px;
    -webkit-appearance: none;
    height: 6px;
    background: transparent;
    box-shadow: -1000px 0 0 1000px rgb(139 115 239);
  }
  input[type="range"]::-moz-range-progress {
    background-color: rgb(139 115 239); 
  }
  input[type="range"]::-moz-range-track {  
    background-color: rgb(214 215 216);
  }
  input[type="range"]::-ms-fill-lower {
    background-color: rgb(139 115 239); 
  }
  input[type="range"]::-ms-fill-upper {  
    background-color: rgb(214 215 216);
  }
</style>

<canvas id="webgl" style="position: absolute; inset: 0; z-index: -1"></canvas>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
    }
  }
</script>

<script type="module" >  
  window.vertexShader = `
    varying vec2 vUv;
    varying vec3 vPosition;
    varying float x;
    varying float y;
    varying float z;
    uniform float[64] tAudioData;
    uniform float uTime;
    uniform float uWavesElevation;
    uniform float uWavesSpeed;
    varying float vElevation;
    void main() {
      vUv = uv;
      vPosition = position;

      x = abs(position.x);
      y = abs(position.y);

      float floor_x = round(x);
      float floor_y = round(y);

      z = sin(tAudioData[int(floor_x)] / 32.0 + tAudioData[int(floor_y)] / 32.0) * 0.25;

      float sin1 = sin((position.x + position.y) * 0.2 + uTime * uWavesSpeed);
      float sin2 = sin((position.x - position.y) * 0.2 + uTime * uWavesSpeed);
      float sin3 = sin((position.x + position.y) * -0.25 + uTime * uWavesSpeed);
      vec3 updatePosition = vec3(position.x, position.y, z);

      vec4 modelPosition = modelMatrix * vec4(updatePosition, 1.0);

      float elevation = sin1 * sin2 * sin3 * uWavesElevation;

      modelPosition.y += elevation;

      gl_Position = projectionMatrix * viewMatrix * modelPosition;

      vElevation = elevation;
    }`;
  window.fragmentShader = `
    varying vec2 vUv;
    varying vec3 vPosition;
    uniform float uTime;
    uniform float uStartTime; 
    const float duration = 2.0;
    const float delay = 0.0;
    uniform bool uAudioEnhanced;
    uniform bool uAudioEnhancedInitially;

    uniform vec3 uDepthColor;
    uniform vec3 uSurfaceColor;
    varying float vElevation;

    float sdfCircle(vec2 p, float r) {
      return length(p) - r;
    }

    void main() {
      float now = clamp((uTime - delay) / duration, 0.1, 1.0);
      float opacity = (1.0 - length(vPosition.xy / vec2(32.0))) * now;

      float speed = 0.5;
      float w = clamp((uTime-uStartTime) / speed, 0., 1.);
      w = mix(float(uAudioEnhancedInitially)*1.0-w, w, float(uAudioEnhanced));

      vec3 defaultColor = mix(uDepthColor, uSurfaceColor, vElevation * 2.5 + 0.75);
      vec3 enhancedColor = vec3(vUv, 1.0);

      float radius = 16.0 * w;
      float distance = sdfCircle( vPosition.xy, radius );

      vec3 gradientColor = mix(enhancedColor, defaultColor, step(radius, distance));
      
      gl_FragColor = vec4(gradientColor, opacity);
    }`;
</script>

<script type="module" src="./index.js"></script>